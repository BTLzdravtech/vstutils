{% extends "base.html" %}
{% load staticfiles %}
{% load i18n %}

{% block style %}
    <link rel="shortcut icon" href="{{host_url}}{% static 'img/logo/favicon.ico' %}?v={{gui_version}}" />
    <!-- Google Font -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,500,600,700,800,900,300italic,400italic,600italic">
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="{{host_url}}{% static 'bootstrap/css/bootstrap.min.css' %}?v={{gui_version}}">

    <link href="{{host_url}}{% static 'auth/main.css' %}" rel="stylesheet">
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
{% endblock %}


{% block body %}
<!-- app-login-page -->
<body class="hold-transition login-page">
  <div class="mobile-index">

      <div class="mobile-index-body">

          <div class="mobile-index-body-inner">
              <img src="{{host_url}}{% static 'img/logo/vertical.png' %}?v={{gui_version}}" alt="Polemarch logo" class="img-responsive center-block logo-img">
               <!-- <h1>Polemarch</h1> -->
                <h2>Manage servers with comfort</h2>

                <form method="post" action="{% url 'login' %}" class="app-form-signin form-signin" onsubmit="appAjaxLogin(); return false;">
                    {% csrf_token %}
                    <input type="text" name='{{ form.username.name }}' id="{{ form.username.name }}" value="admin" class="form-control" placeholder="Login" maxlength="254"  required autofocus>
                    <input type="password" name='{{ form.password.name }}' id="{{ form.password.name }}" value="admin"  class="form-control" placeholder="Password">
                    <!--<button>Log in</button>-->
                    <button type="submit">Sign In</button>
                    <input type="hidden" name="next" value="{{ next }}" />
                    {% if form.errors %}
                    {% if form.non_field_errors %}
                        <ul class='form-errors'>
                            {% for error in form.non_field_errors %}
                                <li style='color: red'>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    {% endif %}
                </form>
          </div>
      </div>
  </div>
    
<script>
    
window.hostname = "{{host_url}}"

function appAjaxLogin()
{ 
    var fileds = document.querySelectorAll(".app-form-signin input")
        
    var fd = new FormData();
    data = {}
    for(var i = 0; i < fileds.length; i++)
    {
        fd.append(fileds[i].getAttribute('name'), fileds[i].value); 
        data[fileds[i].getAttribute('name')] = fileds[i].value
    }

    var request = new XMLHttpRequest(); 
    
    request.onreadystatechange = function()
    {
        if (request.readyState === 4 && request.status === 200)
        {
            if(request.responseText.indexOf("<!-- app-gui-page -->") != -1)
            {
                if(window.parent && window.parent.jQuery)
                {
                    window.parent.jQuery(window.document.getElementsByName("body")[0]).html(request.responseText)
                }
                else
                {
                    window.location.reload()
                }
            }
            else
            {
                window.location.reload()
            }
        }
    }

    request.onerror =  function (data)
    {
        console.error(data)
    };


    request.open("POST", window.hostname+"/login/"); 
    request.setRequestHeader("{{ csrf_header_name|default:'X-CSRFToken' }}", "{{ csrf_token }}")

    request.send(fd); 
} 
</script>
</body>
{% endblock %}