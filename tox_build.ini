[tox]
envlist = py27-build,py{27,35,36}-wheel,patch_wheel
skipsdist = True

[testenv]
changedir = .
whitelist_externals =
    rm
commands =
  rm -rf build
  build: python setup.py compile -v
  wheel: python setup.py bdist_wheel -v
deps =
  cython>=0.29.2
  -rrequirements-doc.txt

[testenv:patch_wheel]
basepython = python3
whitelist_externals =
    rm
    ls
    grep
    bash
commands =
  bash -c "for whl in `ls dist/*.whl | grep -v manylinux`; do auditwheel repair $whl -w dist/; rm $whl; done"
deps = auditwheel
